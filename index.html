
<script src="/socket.io/socket.io.js"></script>
<script>

// socket.io
var socket = io('http://localhost:8080');
//vom Server Daten empfagen
socket.on('serverdata', function(requestResult){
    if( requestResult["type"] == "sessions" )  builtSessionsResult( requestResult["data"], function(str){ printHTML(str); } );
    if( requestResult["type"] == "person"  )  builtPersonResult( requestResult["data"], function(str){ printHTML(str); } );
    });
    




// print out HTML 
var printHTML = function( str ) {
    document.getElementById("mongoresult").innerHTML += str;
}


// built HTML output 
var builtPersonResult = function(result, callback) {
    var out = "Treffer bei Personen: "+ result.length;
    if( result["result"] === false ) out = "<div>Keine Personen Suchtreffer</div>";
    else {
        out += "<ul>";
        for( i in result ){
            out += "<li>"
                    + result[i]["title"]
                    + "(Nr. <i>"+result[i]["numeric_id"]+"</i>)";
                +"</li>";
        }
    }
    out += "</ul>";
    callback( out );
}

var builtSessionsResult = function(result, callback) {
    var out = "Treffer in Sitzungen: "+ result.length;
    if( result["result"] === false ) out = "<div>Keine Suchtreffer in Sitzungen</div>";
    else {
        out += "<ul>";
        for( i in result ){
            if(result[i]['date_start'] != undefined) {
                var session_start = new Date(result[i]['date_start']);
                var dateStr = session_start.getDate()+"-"+session_start.getMonth()+"-"+session_start.getFullYear();
            }
            else var dateStr = "kein Datum hinterlegt";
                
            out += "<li>"
                        + result[i]['description']
                        +" ("+dateStr+")"
                        + "<br><i>"+result[i]['committee_name']+"</i></div>";
                    +"</li>";
            }
    }
    out += "</ul>";
    callback( out );
}


// Send userdata to server, as db request
var userinput = function(str) {
    if( str.value.length > 3 )
    {
        socket.emit('mongodbsearch', { userdata: str.value });
    }
}

</script>

<html>

    <h1> Suche: </h1
    <div class=usersearch><p id=usersearch></p></div>
    <form>
    <div> Suchbegriff: <input type=text oninput="userinput(this)"> </div>
    </form>

    <div class=mongoresult><p id=mongoresult>Keine Treffer in der DB</p></div>

</html> 